# Docker Compose pentru Laboratorul Săptămânii 2
# Laborator Rețele de Calculatoare - ASE, Informatică Economică
# by Revolvix
#
# Adaptat pentru mediul WSL2 + Ubuntu 22.04 + Docker + Portainer
#
# NOTĂ IMPORTANTĂ:
# ================
# Portainer rulează GLOBAL pe portul 9000 și NU este definit aici.
# Accesați Portainer la: http://localhost:9000
# Credențiale: stud / studstudstud
#
# NU folosiți portul 9000 pentru serviciile de laborator!
# Portainer este gestionat separat și rămâne activ între laboratoare.
#
# Arhitectură:
#   - week2_lab: Container principal pentru exerciții (TCP/UDP)
#
# Utilizare:
#   docker compose up -d        # Pornire în fundal
#   docker compose down         # Oprire
#   docker compose logs -f      # Vizualizare loguri
#   docker compose build --no-cache  # Reconstruire imagini

services:
  # Container principal pentru laborator
  week2_lab:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: week2_lab
    hostname: week2-lab
    
    # Porturi expuse
    ports:
      - "9090:9090"    # Server TCP
      - "9091:9091/udp" # Server UDP
    
    # Capabilități pentru operațiuni de rețea avansate
    cap_add:
      - NET_ADMIN      # Administrare interfețe rețea
      - NET_RAW        # Socket-uri raw (pentru tcpdump)
    
    # Volume pentru persistența datelor
    volumes:
      - ../src/exercises:/app/exercises:ro  # Exerciții (doar citire)
      - ../pcap:/app/pcap                   # Capturi de pachete
      - ../artifacts:/app/artifacts         # Artefacte generate
    
    # Variabile de mediu
    environment:
      - PYTHONUNBUFFERED=1
      - PYTHONDONTWRITEBYTECODE=1
      - TZ=Europe/Bucharest
    
    # Menține containerul activ
    stdin_open: true
    tty: true
    
    # Repornire automată
    restart: unless-stopped
    
    # Conectare la rețea
    networks:
      week2_network:
        ipv4_address: 10.0.2.10

# Rețea dedicată pentru acest laborator
# =====================================
# Rețeaua week2_network este izolată pentru acest laborator.
# Subrețeaua 10.0.2.0/24 este specifică Săptămânii 2.
# Alte săptămâni vor folosi subrețele diferite.
networks:
  week2_network:
    name: week2_network
    driver: bridge
    ipam:
      driver: default
      config:
        - subnet: 10.0.2.0/24
          gateway: 10.0.2.1

# Volume pentru date persistente
# ==============================
# Notă: Nu este definit niciun volum Portainer aici.
# Volumul portainer_data este gestionat global.
volumes: {}
