# Diagrame Flux - Exerciții Săptămâna 13

> Laborator IoT și Securitate în Rețelele de Calculatoare
>
> Curs REȚELE DE CALCULATOARE - ASE, Informatică | de Revolvix

---

## Exercițiul 1: Scanner Porturi TCP

### Flux Principal

```
┌─────────────────┐
│   START         │
└────────┬────────┘
         │
         ▼
┌─────────────────┐
│  Parsează       │
│  argumente CLI  │
│  (argparse)     │
└────────┬────────┘
         │
         ▼
┌─────────────────┐
│  Parsează       │
│  specificație   │
│  porturi        │
│  "1-100,443"    │
└────────┬────────┘
         │
         ▼
┌─────────────────┐
│  Parsează       │
│  ținte IP       │
│  "10.0.13.1-15" │
└────────┬────────┘
         │
         ▼
┌─────────────────┐
│  Creează        │
│  ThreadPool     │
│  (50 workeri)   │
└────────┬────────┘
         │
         ▼
┌─────────────────────────────────────────────────────┐
│                 PENTRU FIECARE PORT                  │
│  ┌─────────────────────────────────────────────┐    │
│  │                                             │    │
│  │  ┌─────────────┐    ┌─────────────┐        │    │
│  │  │ Creează     │───▶│ Încearcă    │        │    │
│  │  │ socket TCP  │    │ connect()   │        │    │
│  │  └─────────────┘    └──────┬──────┘        │    │
│  │                            │               │    │
│  │           ┌────────────────┼────────────┐  │    │
│  │           │                │            │  │    │
│  │           ▼                ▼            ▼  │    │
│  │     ┌──────────┐    ┌──────────┐  ┌──────────┐ │
│  │     │ Succes   │    │ Refuzat  │  │ Timeout  │ │
│  │     │ DESCHIS  │    │ ÎNCHIS   │  │ FILTRAT  │ │
│  │     └────┬─────┘    └──────────┘  └──────────┘ │
│  │          │                                     │
│  │          ▼                                     │
│  │     ┌──────────┐                              │
│  │     │ Încearcă │                              │
│  │     │ banner   │                              │
│  │     │ grabbing │                              │
│  │     └──────────┘                              │
│  │                                               │
│  └───────────────────────────────────────────────┘
│                                                     │
└─────────────────────────────────────────────────────┘
         │
         ▼
┌─────────────────┐
│  Colectează     │
│  rezultate      │
│  din futures    │
└────────┬────────┘
         │
         ▼
┌─────────────────┐
│  Afișează       │
│  sumar          │
└────────┬────────┘
         │
         ▼
┌─────────────────┐     ┌─────────────────┐
│  --output       │────▶│  Salvează       │
│  specificat?    │ DA  │  JSON           │
└────────┬────────┘     └─────────────────┘
         │ NU
         ▼
┌─────────────────┐
│   SFÂRȘIT       │
└─────────────────┘
```

### Stările Porturilor

```
         ┌───────────────────────────────────────────────┐
         │              SCANARE PORT                      │
         └───────────────────────────────────────────────┘
                              │
              ┌───────────────┼───────────────┐
              │               │               │
              ▼               ▼               ▼
       ┌───────────┐   ┌───────────┐   ┌───────────┐
       │  DESCHIS  │   │   ÎNCHIS  │   │  FILTRAT  │
       │           │   │           │   │           │
       │ SYN/ACK   │   │   RST     │   │  Timeout  │
       │ primit    │   │  primit   │   │  (fără    │
       │           │   │           │   │  răspuns) │
       └───────────┘   └───────────┘   └───────────┘
              │
              ▼
       ┌───────────┐
       │  BANNER   │
       │  GRABBING │
       │ (opțional)│
       └───────────┘
```

---

## Exercițiul 2: Client MQTT

### Mod SUBSCRIBE

```
┌─────────────────┐
│   START         │
│   --mod         │
│   subscribe     │
└────────┬────────┘
         │
         ▼
┌─────────────────┐
│  Creează        │
│  client MQTT    │
│  cu callbacks   │
└────────┬────────┘
         │
         ▼
┌─────────────────┐     ┌─────────────────┐
│  --tls          │────▶│  Configurează   │
│  activat?       │ DA  │  TLS context    │
└────────┬────────┘     │  + certificat   │
         │ NU           └────────┬────────┘
         │◀──────────────────────┘
         ▼
┌─────────────────┐
│  Conectare      │
│  broker:port    │
└────────┬────────┘
         │
         ▼
┌─────────────────┐
│  on_connect()   │
│  callback       │
└────────┬────────┘
         │
         ▼
┌─────────────────┐
│  Subscribe      │
│  la topic       │
│  cu QoS         │
└────────┬────────┘
         │
         ▼
┌─────────────────────────────────────────┐
│            LOOP FOREVER                  │
│  ┌───────────────────────────────────┐  │
│  │                                   │  │
│  │  Așteaptă mesaje...               │  │
│  │         │                         │  │
│  │         ▼                         │  │
│  │  ┌─────────────────┐              │  │
│  │  │  on_message()   │              │  │
│  │  │  callback       │              │  │
│  │  │  - decodează    │              │  │
│  │  │  - afișează     │              │  │
│  │  └─────────────────┘              │  │
│  │                                   │  │
│  └───────────────────────────────────┘  │
│                                         │
│  [Ctrl+C pentru a opri]                 │
└─────────────────────────────────────────┘
         │
         ▼
┌─────────────────┐
│  Deconectare    │
│  curată         │
└────────┬────────┘
         │
         ▼
┌─────────────────┐
│   SFÂRȘIT       │
└─────────────────┘
```

### Mod PUBLISH

```
┌─────────────────┐
│   START         │
│   --mod         │
│   publish       │
└────────┬────────┘
         │
         ▼
┌─────────────────┐
│  Creează        │
│  client MQTT    │
└────────┬────────┘
         │
         ▼
┌─────────────────┐
│  Conectare      │
│  broker:port    │
└────────┬────────┘
         │
         ▼
┌─────────────────┐
│  Așteaptă       │
│  conectare      │
│  (1 sec)        │
└────────┬────────┘
         │
         ▼
┌─────────────────┐
│  Publică        │
│  mesaj pe       │
│  topic + QoS    │
└────────┬────────┘
         │
         ▼
┌─────────────────┐
│  Așteaptă       │
│  confirmare     │
│  (ACK)          │
└────────┬────────┘
         │
         ▼
┌─────────────────┐
│  Deconectare    │
└────────┬────────┘
         │
         ▼
┌─────────────────┐
│   SFÂRȘIT       │
└─────────────────┘
```

### Fluxul QoS 2 (Exactly Once)

```
   Publisher              Broker              Subscriber
       │                    │                     │
       │───── PUBLISH ─────▶│                     │
       │      (QoS=2)       │                     │
       │                    │                     │
       │◀──── PUBREC ───────│                     │
       │   (received)       │                     │
       │                    │                     │
       │───── PUBREL ──────▶│───── PUBLISH ──────▶│
       │   (release)        │      (QoS=2)        │
       │                    │                     │
       │◀──── PUBCOMP ──────│◀──── PUBACK ────────│
       │   (complete)       │                     │
       │                    │                     │
       
   ✓ Mesajul ajunge EXACT O DATĂ la subscriber
```

---

## Exercițiul 3: Sniffer Pachete

### Flux Principal

```
┌─────────────────┐
│   START         │
│   (necesită     │
│   sudo)         │
└────────┬────────┘
         │
         ▼
┌─────────────────┐
│  Parsează       │
│  argumente      │
│  --numar        │
│  --filtru       │
│  --output       │
└────────┬────────┘
         │
         ▼
┌─────────────────┐
│  Detectează     │
│  interfețe      │
│  disponibile    │
└────────┬────────┘
         │
         ▼
┌─────────────────┐
│  Inițializează  │
│  Scapy sniffer  │
│  cu filtru BPF  │
└────────┬────────┘
         │
         ▼
┌─────────────────────────────────────────────────────┐
│              PENTRU FIECARE PACHET                   │
│  ┌───────────────────────────────────────────────┐  │
│  │                                               │  │
│  │  ┌─────────────┐                             │  │
│  │  │  Capturează │                             │  │
│  │  │  pachet raw │                             │  │
│  │  └──────┬──────┘                             │  │
│  │         │                                    │  │
│  │         ▼                                    │  │
│  │  ┌─────────────────────────────────────────┐│  │
│  │  │        PARSEAZĂ STRATURI                ││  │
│  │  │                                         ││  │
│  │  │  ┌─────────┐  ┌─────────┐  ┌─────────┐ ││  │
│  │  │  │Ethernet │─▶│   IP    │─▶│TCP/UDP  │ ││  │
│  │  │  │ Layer 2 │  │ Layer 3 │  │Layer 4  │ ││  │
│  │  │  └─────────┘  └─────────┘  └─────────┘ ││  │
│  │  │       │            │            │      ││  │
│  │  │       ▼            ▼            ▼      ││  │
│  │  │  MAC src/dst   IP src/dst   Port s/d  ││  │
│  │  │                TTL, Proto   Flags     ││  │
│  │  │                                        ││  │
│  │  └─────────────────────────────────────────┘│  │
│  │         │                                    │  │
│  │         ▼                                    │  │
│  │  ┌─────────────┐                             │  │
│  │  │  Afișează   │                             │  │
│  │  │  rezumat    │                             │  │
│  │  └─────────────┘                             │  │
│  │                                               │  │
│  └───────────────────────────────────────────────┘  │
│                                                     │
│  [Până la --numar pachete sau Ctrl+C]               │
└─────────────────────────────────────────────────────┘
         │
         ▼
┌─────────────────┐     ┌─────────────────┐
│  --output       │────▶│  Salvează       │
│  specificat?    │ DA  │  .pcap          │
└────────┬────────┘     └─────────────────┘
         │ NU
         ▼
┌─────────────────┐
│  Afișează       │
│  statistici     │
└────────┬────────┘
         │
         ▼
┌─────────────────┐
│   SFÂRȘIT       │
└─────────────────┘
```

### Structura Pachetului (OSI)

```
┌─────────────────────────────────────────────────────────────┐
│                    PACHET CAPTURAT                           │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  Layer 2: ETHERNET                                          │
│  ┌─────────────────────────────────────────────────────┐   │
│  │ Dest MAC (6B) │ Src MAC (6B) │ EtherType (2B)       │   │
│  │ ff:ff:ff:...  │ 00:15:5d:... │ 0x0800 (IPv4)        │   │
│  └─────────────────────────────────────────────────────┘   │
│                              │                              │
│                              ▼                              │
│  Layer 3: IP                                                │
│  ┌─────────────────────────────────────────────────────┐   │
│  │ Version │ IHL │ TOS │ Total Len │ ID │ Flags │ TTL │   │
│  │    4    │  5  │  0  │    60     │... │  DF   │ 64  │   │
│  │─────────────────────────────────────────────────────│   │
│  │ Protocol │ Checksum │ Src IP      │ Dest IP        │   │
│  │    6     │  0x....  │ 10.0.13.1   │ 10.0.13.100    │   │
│  └─────────────────────────────────────────────────────┘   │
│                              │                              │
│                              ▼                              │
│  Layer 4: TCP                                               │
│  ┌─────────────────────────────────────────────────────┐   │
│  │ Src Port │ Dst Port │ Seq Num │ Ack Num │ Flags    │   │
│  │  54321   │   1883   │ 1000    │  2000   │ SYN,ACK  │   │
│  └─────────────────────────────────────────────────────┘   │
│                              │                              │
│                              ▼                              │
│  Layer 7: APPLICATION (MQTT)                                │
│  ┌─────────────────────────────────────────────────────┐   │
│  │ Msg Type │ Flags │ Remaining Len │ Payload...       │   │
│  │ PUBLISH  │  0x0  │     15        │ {"temp": 23.5}   │   │
│  └─────────────────────────────────────────────────────┘   │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

---

## Exercițiul 4: Verificator Vulnerabilități

### Flux Principal

```
┌─────────────────┐
│   START         │
└────────┬────────┘
         │
         ▼
┌─────────────────┐
│  Parsează       │
│  argumente      │
│  --tinta        │
│  --toate/--ftp  │
│  --mqtt/etc     │
└────────┬────────┘
         │
         ▼
┌─────────────────┐
│  Inițializează  │
│  Verificator    │
└────────┬────────┘
         │
         ▼
┌─────────────────────────────────────────────────────────────┐
│                    VERIFICĂRI SERVICII                       │
│                                                             │
│  ┌─────────────────┐  ┌─────────────────┐                  │
│  │  --ftp          │  │  --mqtt         │                  │
│  │                 │  │                 │                  │
│  │  ✓ Versiune     │  │  ✓ Autentificare│                  │
│  │  ✓ Anon login   │  │  ✓ TLS config   │                  │
│  │  ✓ Backdoor     │  │  ✓ ACL topicuri │                  │
│  │    (port 6200)  │  │                 │                  │
│  └────────┬────────┘  └────────┬────────┘                  │
│           │                    │                            │
│  ┌─────────────────┐  ┌─────────────────┐                  │
│  │  --http         │  │  --generic      │                  │
│  │                 │  │                 │                  │
│  │  ✓ Headers sec  │  │  ✓ Banner grab  │                  │
│  │  ✓ HTTPS redir  │  │  ✓ Versiuni     │                  │
│  │  ✓ Cookies      │  │  ✓ CVE lookup   │                  │
│  └────────┬────────┘  └────────┬────────┘                  │
│           │                    │                            │
│           └────────────────────┘                            │
│                      │                                      │
└──────────────────────┼──────────────────────────────────────┘
                       │
                       ▼
┌─────────────────────────────────────────────────────────────┐
│              PENTRU FIECARE VULNERABILITATE                  │
│                                                             │
│  ┌─────────────────────────────────────────────────────┐   │
│  │                                                     │   │
│  │  Atribuie SEVERITATE:                               │   │
│  │                                                     │   │
│  │  ┌──────────┐ ┌──────────┐ ┌──────────┐ ┌────────┐│   │
│  │  │ CRITIC   │ │ RIDICAT  │ │  MEDIU   │ │ SCĂZUT ││   │
│  │  │  (roșu)  │ │(magenta) │ │(galben)  │ │(albast)││   │
│  │  │          │ │          │ │          │ │        ││   │
│  │  │ Backdoor │ │ No TLS   │ │ Weak pwd │ │ Info   ││   │
│  │  │ RCE      │ │ Anon FTP │ │ Old ver  │ │ expose ││   │
│  │  └──────────┘ └──────────┘ └──────────┘ └────────┘│   │
│  │                                                     │   │
│  │  Generează REMEDIERE recomandată                    │   │
│  │                                                     │   │
│  └─────────────────────────────────────────────────────┘   │
│                                                             │
└─────────────────────────────────────────────────────────────┘
                       │
                       ▼
┌─────────────────┐
│  Generează      │
│  raport:        │
│  - Sumar        │
│  - Detalii      │
│  - Remedieri    │
└────────┬────────┘
         │
         ▼
┌─────────────────┐     ┌─────────────────┐
│  --output       │────▶│  Export         │
│  specificat?    │ DA  │  JSON           │
└────────┬────────┘     └─────────────────┘
         │ NU
         ▼
┌─────────────────┐
│   SFÂRȘIT       │
└─────────────────┘
```

### Matricea Severități

```
┌─────────────────────────────────────────────────────────────────┐
│                    CLASIFICARE SEVERITATE                        │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│   CRITIC (9.0-10.0)          RIDICAT (7.0-8.9)                  │
│   ┌───────────────────┐      ┌───────────────────┐              │
│   │ • Backdoor activ  │      │ • Lipsa TLS       │              │
│   │ • RCE exploatabil │      │ • Acces anonim    │              │
│   │ • Auth bypass     │      │ • Credențiale     │              │
│   │                   │      │   implicite       │              │
│   │ Acțiune: IMEDIAT  │      │ Acțiune: 24-48h   │              │
│   └───────────────────┘      └───────────────────┘              │
│                                                                 │
│   MEDIU (4.0-6.9)            SCĂZUT (0.1-3.9)                   │
│   ┌───────────────────┐      ┌───────────────────┐              │
│   │ • Versiune veche  │      │ • Info disclosure │              │
│   │ • Parolă slabă    │      │ • Banner verbose  │              │
│   │ • Config greșită  │      │ • Minor misconfig │              │
│   │                   │      │                   │              │
│   │ Acțiune: 1 săpt   │      │ Acțiune: Planif.  │              │
│   └───────────────────┘      └───────────────────┘              │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

---

## Legenda Simboluri

| Simbol | Semnificație |
|--------|--------------|
| `┌─┐` `└─┘` | Bloc/proces |
| `─▶` | Flux de date/control |
| `│` | Continuare verticală |
| `◀──` | Răspuns/confirmare |
| `[text]` | Condiție/acțiune utilizator |

---

*Curs REȚELE DE CALCULATOARE - ASE, Informatică | de Revolvix*
