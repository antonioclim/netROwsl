# Diagrame Săptămâna 6

> Disciplina REȚELE DE CALCULATOARE - ASE, Informatică Economică | de ing. dr. Antonio Clim

Diagrame ASCII pentru prezentări și materiale de curs.

---

## Flux traducere NAT (pentru prezentare)

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                                                                             │
│   h1 (192.168.1.10)                                    h3 (203.0.113.2)     │
│         │                                                     │             │
│         │  ① Pachet original                                  │             │
│         │  src=192.168.1.10:45678                             │             │
│         │  dst=203.0.113.2:5000                               │             │
│         ▼                                                     │             │
│   ┌─────────────────────┐                                     │             │
│   │    Router NAT       │                                     │             │
│   │  ┌───────────────┐  │                                     │             │
│   │  │ Tabela NAT    │  │                                     │             │
│   │  │ 50001 ← 45678 │  │                                     │             │
│   │  └───────────────┘  │                                     │             │
│   └─────────┬───────────┘                                     │             │
│             │                                                 │             │
│             │  ② Pachet tradus                                │             │
│             │  src=203.0.113.1:50001  ─────────────────────────▶             │
│             │  dst=203.0.113.2:5000                           │             │
│             │                                                 │             │
│             │  ③ Răspuns                                      │             │
│             │  src=203.0.113.2:5000   ◀─────────────────────────             │
│             │  dst=203.0.113.1:50001                          │             │
│             ▼                                                 │             │
│   ┌─────────────────────┐                                     │             │
│   │  ④ Traducere inversă│                                     │             │
│   │  dst=192.168.1.10:45678                                   │             │
│   └─────────────────────┘                                     │             │
│             │                                                 │             │
│             ▼                                                 │             │
│   h1 primește răspunsul                                       │             │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

---

## Arhitectura SDN (3 planuri)

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                         PLANUL APLICAȚIE                                    │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐                         │
│  │ Firewall    │  │ Load        │  │ Monitoring  │                         │
│  │ App         │  │ Balancer    │  │ App         │                         │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘                         │
│         └────────────────┼────────────────┘                                │
│                          │ Northbound API (REST)                           │
├──────────────────────────┼──────────────────────────────────────────────────┤
│                          ▼                                                 │
│                 ┌─────────────────┐                                        │
│   PLANUL       │   Controller    │     ← sdn_policy_controller.py         │
│   CONTROL      │   (OS-Ken)      │                                        │
│                 └────────┬────────┘                                        │
│                          │ Southbound (OpenFlow 1.3)                       │
├──────────────────────────┼──────────────────────────────────────────────────┤
│                          ▼                                                 │
│   PLANUL       ┌─────────────────┐                                        │
│   DATE         │   Switch OVS    │     ← Tabele de fluxuri                │
│                 └─────┬───┬───┬───┘                                        │
│                   ┌───┘   │   └───┐                                        │
│                   ▼       ▼       ▼                                        │
│                  h1      h2      h3                                        │
└─────────────────────────────────────────────────────────────────────────────┘
```

---

## Procesul DORA (DHCP)

```
┌──────────────┐                              ┌──────────────┐
│   Client     │                              │   Server     │
│   DHCP       │                              │   DHCP       │
└──────┬───────┘                              └──────┬───────┘
       │                                             │
       │  ① DISCOVER (broadcast)                     │
       │  "Cine poate să-mi dea un IP?"              │
       │─────────────────────────────────────────────▶
       │                                             │
       │  ② OFFER                                    │
       │  "Eu! Îți ofer 192.168.1.100"               │
       ◀─────────────────────────────────────────────│
       │                                             │
       │  ③ REQUEST                                  │
       │  "Accept oferta ta!"                        │
       │─────────────────────────────────────────────▶
       │                                             │
       │  ④ ACKNOWLEDGE                              │
       │  "Confirmat. IP-ul e al tău pentru 1 oră"   │
       ◀─────────────────────────────────────────────│
       │                                             │
```

---

## Topologia NAT (simplificată)

```
     ┌─────────────────────────────────────────────────────────────┐
     │                    Rețea privată                            │
     │                    192.168.1.0/24                           │
     │                                                             │
     │   ┌───────────┐              ┌───────────┐                  │
     │   │    h1     │              │    h2     │                  │
     │   │.10        │              │.20        │                  │
     │   └─────┬─────┘              └─────┬─────┘                  │
     │         │                          │                        │
     │         └──────────┬───────────────┘                        │
     │                    │                                        │
     │              ┌─────┴─────┐                                   │
     │              │    s1     │                                   │
     │              └─────┬─────┘                                   │
     └────────────────────┼────────────────────────────────────────┘
                          │ eth0: 192.168.1.1
                    ┌─────┴─────┐
                    │   rnat    │  ← MASQUERADE
                    │  (router) │
                    └─────┬─────┘
                          │ eth1: 203.0.113.1
     ┌────────────────────┼────────────────────────────────────────┐
     │                    │                                        │
     │              ┌─────┴─────┐                                   │
     │              │    s2     │                                   │
     │              └─────┬─────┘                                   │
     │                    │                                        │
     │              ┌─────┴─────┐                                   │
     │              │    h3     │                                   │
     │              │.2         │                                   │
     │              └───────────┘                                   │
     │                                                             │
     │                    Rețea publică                            │
     │                    203.0.113.0/24 (TEST-NET-3)              │
     └─────────────────────────────────────────────────────────────┘
```

---

## Topologia SDN

```
                          ┌─────────────────────────────┐
                          │      Controller SDN         │
                          │       (OS-Ken)              │
                          │  ┌──────────────────────┐   │
                          │  │  Motor de politici   │   │
                          │  │  • h1↔h2: PERMITE    │   │
                          │  │  • *→h3: BLOCHEAZĂ   │   │
                          │  └──────────────────────┘   │
                          └─────────────┬───────────────┘
                                        │ OpenFlow 1.3
    ┌───────────────────────────────────┼───────────────────────────────────┐
    │                           ┌───────┴───────┐                           │
    │                           │      s1       │                           │
    │                           │   (OVS)       │                           │
    │                           └───┬───┬───┬───┘                           │
    │                    ┌──────────┘   │   └──────────┐                    │
    │              ┌─────┴─────┐  ┌─────┴─────┐  ┌─────┴─────┐              │
    │              │    h1     │  │    h2     │  │    h3     │              │
    │              │10.0.6.11  │  │10.0.6.12  │  │10.0.6.13  │              │
    │              │ [ACCES    │  │  [SERVER] │  │  [ACCES   │              │
    │              │  COMPLET] │  │           │  │RESTRICȚ.] │              │
    │              └───────────┘  └───────────┘  └───────────┘              │
    │                        Rețea SDN: 10.0.6.0/24                         │
    └───────────────────────────────────────────────────────────────────────┘
```

---

## Structura intrării în tabela de fluxuri OpenFlow

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                        INTRARE TABELĂ FLUXURI                               │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│  ┌─────────────┐  ┌─────────────────────────────┐  ┌─────────────────────┐ │
│  │  PRIORITATE │  │     CÂMPURI POTRIVIRE       │  │      ACȚIUNI        │ │
│  │             │  │                             │  │                     │ │
│  │    250      │  │  eth_type = 0x0800 (IPv4)   │  │  output:2           │ │
│  │             │  │  ip_proto = 1 (ICMP)        │  │  sau                │ │
│  │  (mai mare  │  │  nw_src = 10.0.6.11         │  │  drop               │ │
│  │   = prima)  │  │  nw_dst = 10.0.6.12         │  │  sau                │ │
│  │             │  │  in_port = 1                │  │  controller         │ │
│  └─────────────┘  └─────────────────────────────┘  └─────────────────────┘ │
│                                                                             │
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │                         CONTOARE                                    │   │
│  │  n_packets=1234   n_bytes=98765   duration=3600s                    │   │
│  └─────────────────────────────────────────────────────────────────────┘   │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

---

## Analogie: Conntrack ca Registru de Hotel

```
╔═══════════════════════════════════════════════════════════════════════════╗
║  REGISTRUL RECEPȚIEI HOTELULUI (tabela conntrack)                         ║
╠═══════════════════════════════════════════════════════════════════════════╣
║                                                                           ║
║  "Bună ziua, am un colet pentru camera 50001"                             ║
║                                                                           ║
║  ┌─────────────────────────────────────────────────────────────────────┐  ║
║  │  Camera   │  Oaspete intern           │  Vizitator extern    │ Stare║  ║
║  ├───────────┼───────────────────────────┼──────────────────────┼──────┤  ║
║  │  50001    │  h1 (192.168.1.10:45678)  │  h3 (203.0.113.2)    │ ACTIV║  ║
║  │  50002    │  h2 (192.168.1.20:34567)  │  h3 (203.0.113.2)    │ ACTIV║  ║
║  │  50003    │  h1 (192.168.1.10:45679)  │  server.com          │ ACTIV║  ║
║  └───────────┴───────────────────────────┴──────────────────────┴──────┘  ║
║                                                                           ║
║  Recepționerul: "Camera 50001? Momentan acolo stă domnul h1,              ║
║                  îi trimit coletul imediat!"                              ║
║                                                                           ║
╚═══════════════════════════════════════════════════════════════════════════╝
```

---

## Utilizare

Aceste diagrame pot fi:
- Copiate în prezentări (font monospace: Consolas, Courier New)
- Afișate pe proiector în timpul explicațiilor
- Incluse în documentație markdown
- Tipărite pentru studenți (A4 landscape)

Pentru diagrame interactive, folosește:
- draw.io (https://app.diagrams.net/)
- Excalidraw (https://excalidraw.com/)

---

*Disciplina REȚELE DE CALCULATOARE - ASE, Informatică Economică | de ing. dr. Antonio Clim*
